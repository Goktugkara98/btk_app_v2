{% extends "admin/base_admin.html" %}

{% block title %}Dashboard{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Müfredat yönetimi genel bakış{% endblock %}

{% block content %}
<!-- Stats Overview -->
<div class="stats-grid">
    <div class="stat-card primary">
        <div class="stat-header">
            <div class="stat-title">Toplam Sınıf</div>
            <div class="stat-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
        </div>
        <div class="stat-value" id="total-grades">0</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>Son güncelleme</span>
        </div>
    </div>

    <div class="stat-card success">
        <div class="stat-header">
            <div class="stat-title">Toplam Ders</div>
            <div class="stat-icon">
                <i class="fas fa-book"></i>
            </div>
        </div>
        <div class="stat-value" id="total-subjects">0</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>Son güncelleme</span>
        </div>
    </div>

    <div class="stat-card warning">
        <div class="stat-header">
            <div class="stat-title">Toplam Ünite</div>
            <div class="stat-icon">
                <i class="fas fa-cube"></i>
            </div>
        </div>
        <div class="stat-value" id="total-units">0</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>Son güncelleme</span>
        </div>
    </div>

    <div class="stat-card info">
        <div class="stat-header">
            <div class="stat-title">Toplam Konu</div>
            <div class="stat-icon">
                <i class="fas fa-tag"></i>
            </div>
        </div>
        <div class="stat-value" id="total-topics">0</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>Son güncelleme</span>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="admin-card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-bolt"></i>
            Hızlı İşlemler
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{{ url_for('pages.admin_pages.grades_management') }}" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-4">
                    <i class="fas fa-graduation-cap fa-2x mb-2"></i>
                    <span class="fw-semibold">Sınıfları Yönet</span>
                    <small class="text-muted">Sınıf ekle, düzenle, sil</small>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{{ url_for('pages.admin_pages.subjects_management') }}" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-4">
                    <i class="fas fa-book fa-2x mb-2"></i>
                    <span class="fw-semibold">Dersleri Yönet</span>
                    <small class="text-muted">Ders ekle, düzenle, sil</small>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{{ url_for('pages.admin_pages.units_management') }}" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center py-4">
                    <i class="fas fa-cube fa-2x mb-2"></i>
                    <span class="fw-semibold">Üniteleri Yönet</span>
                    <small class="text-muted">Ünite ekle, düzenle, sil</small>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{{ url_for('pages.admin_pages.topics_management') }}" class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-4">
                    <i class="fas fa-tag fa-2x mb-2"></i>
                    <span class="fw-semibold">Konuları Yönet</span>
                    <small class="text-muted">Konu ekle, düzenle, sil</small>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="admin-card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-history"></i>
            Son Aktiviteler
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6 class="text-muted mb-3">Son Eklenen Dersler</h6>
                <div id="recent-subjects">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-book fa-2x mb-2"></i>
                        <p>Henüz ders eklenmemiş</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <h6 class="text-muted mb-3">Son Eklenen Üniteler</h6>
                <div id="recent-units">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-cube fa-2x mb-2"></i>
                        <p>Henüz ünite eklenmemiş</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Status -->
<div class="admin-card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-server"></i>
            Sistem Durumu
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <div class="bg-success rounded-circle p-2 me-3">
                        <i class="fas fa-database text-white"></i>
                    </div>
                    <div>
                        <div class="fw-semibold">Veritabanı</div>
                        <small class="text-success">Bağlı</small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <div class="bg-success rounded-circle p-2 me-3">
                        <i class="fas fa-server text-white"></i>
                    </div>
                    <div>
                        <div class="fw-semibold">Sunucu</div>
                        <small class="text-success">Çalışıyor</small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <div class="bg-success rounded-circle p-2 me-3">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <div>
                        <div class="fw-semibold">Güvenlik</div>
                        <small class="text-success">Aktif</small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="d-flex align-items-center">
                    <div class="bg-success rounded-circle p-2 me-3">
                        <i class="fas fa-sync text-white"></i>
                    </div>
                    <div>
                        <div class="fw-semibold">Senkronizasyon</div>
                        <small class="text-success">Güncel</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Dashboard specific functionality
class DashboardManager {
    constructor() {
        this.init();
    }

    init() {
        console.log('Dashboard Manager initialized');
        this.loadRecentData();
    }

    async loadRecentData() {
        try {
            // Load recent subjects
            const subjectsResponse = await apiRequest('/admin/subjects?limit=5');
            if (subjectsResponse.success && subjectsResponse.data) {
                this.updateRecentSubjects(subjectsResponse.data);
            }

            // Load recent units
            const unitsResponse = await apiRequest('/admin/units?limit=5');
            if (unitsResponse.success && unitsResponse.data) {
                this.updateRecentUnits(unitsResponse.data);
            }
        } catch (error) {
            console.error('Error loading recent data:', error);
        }
    }

    updateRecentSubjects(subjects) {
        const container = document.getElementById('recent-subjects');
        if (!container) return;

        if (subjects.length === 0) {
            container.innerHTML = `
                <div class="text-center text-muted py-4">
                    <i class="fas fa-book fa-2x mb-2"></i>
                    <p>Henüz ders eklenmemiş</p>
                </div>
            `;
            return;
        }

        const html = subjects.map(subject => `
            <div class="d-flex align-items-center py-2 border-bottom">
                <div class="bg-primary rounded-circle p-2 me-3">
                    <i class="fas fa-book text-white fa-sm"></i>
                </div>
                <div class="flex-grow-1">
                    <div class="fw-semibold">${subject.subject_name}</div>
                    <small class="text-muted">${subject.grade_name || 'Sınıf belirtilmemiş'}</small>
                </div>
                <small class="text-muted">${this.formatDate(subject.created_at)}</small>
            </div>
        `).join('');

        container.innerHTML = html;
    }

    updateRecentUnits(units) {
        const container = document.getElementById('recent-units');
        if (!container) return;

        if (units.length === 0) {
            container.innerHTML = `
                <div class="text-center text-muted py-4">
                    <i class="fas fa-cube fa-2x mb-2"></i>
                    <p>Henüz ünite eklenmemiş</p>
                </div>
            `;
            return;
        }

        const html = units.map(unit => `
            <div class="d-flex align-items-center py-2 border-bottom">
                <div class="bg-warning rounded-circle p-2 me-3">
                    <i class="fas fa-cube text-white fa-sm"></i>
                </div>
                <div class="flex-grow-1">
                    <div class="fw-semibold">${unit.unit_name}</div>
                    <small class="text-muted">${unit.subject_name || 'Ders belirtilmemiş'}</small>
                </div>
                <small class="text-muted">${this.formatDate(unit.created_at)}</small>
            </div>
        `).join('');

        container.innerHTML = html;
    }

    formatDate(dateString) {
        if (!dateString) return 'Tarih belirtilmemiş';
        const date = new Date(dateString);
        return date.toLocaleDateString('tr-TR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    }

    refresh() {
        this.loadRecentData();
        showToast('Dashboard verileri yenilendi!', 'success');
    }
}

// Initialize dashboard manager
document.addEventListener('DOMContentLoaded', () => {
    window.currentPageManager = new DashboardManager();
});
</script>
{% endblock %}
